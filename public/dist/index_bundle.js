(()=>{"use strict";var e={607:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(768),a=i(363),r=i(934),d=i(630),l=n(i(10)),o=document.getElementById("canvas"),h=(o.getContext("2d"),window.devicePixelRatio);o.style.width=`${window.innerWidth}px`,o.style.height=`${window.innerHeight}px`,o.width=window.innerWidth*h,o.height=window.innerHeight*h;const c=new a.Player("tester"),p=new d.Opponent;for(let e=0;e<5;e++)c.addToDeck(new s.Card({uid:c.deck.size,name:"loti",attack:10,defence:10,health:10}));const f=new r.Game(5,{player:c,opponent:p});l.default.loadAll(["../public/assets/deck-zone.png","../public/assets/card-zoneX3.png","../public/assets/card-zoneX4.png","../public/assets/card-zoneX5.png","../public/assets/card/frontX4.png"]).then((()=>{f.start()}))},10:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});class n{static loadAll(e){return i(this,void 0,void 0,(function*(){yield new Promise((t=>i(this,void 0,void 0,(function*(){const i=e.map(((e,t)=>new Promise((i=>{const s=new Image;s.src=e,s.addEventListener("load",(()=>{n.assets[e]=s,i(t)}))}))));n.promises=i,yield Promise.allSettled(i).then((e=>{t("done"),console.log(e)}))}))))}))}static get(e){return n.assets[e]}}n.assets={},t.default=n},826:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Wait=void 0,t.Wait=function(e){return new Promise((t=>{setTimeout((()=>{t("")}),1e3*e)}))}},934:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;const s=i(826),a=i(87),r=document.getElementById("bell"),d=document.getElementById("card-info-on-hand");t.Game=class{constructor(e,t){this.isPlayerTurn=!0,this.phase=1,this.player=t.player,this.opponent=t.opponent,this.numOfCardZone=e,this.field=new a.Field(this.numOfCardZone)}start(){return n(this,void 0,void 0,(function*(){this.init();for(let e=0;e<3;e++)yield(0,s.Wait)(.3),this.drawCard(!0)}))}battle(){for(let e=0;e<this.numOfCardZone;e++)this.isPlayerTurn?this.field.fieldArrange.player[e]&&(this.field.fieldArrange.opponent[e]?(this.field.fieldArrange.opponent[e].heal-=this.field.fieldArrange.player[e].atk,this.field.fieldArrange.opponent[e].heal<=0&&this.field.kill(0,e)):console.log("직접공격")):this.field.fieldArrange.opponent[e]&&(this.field.fieldArrange.player[e]?(this.field.fieldArrange.player[e].heal-=this.field.fieldArrange.opponent[e].atk,this.field.fieldArrange.player[e].heal<=0&&this.field.kill(1,e)):console.log("직접공격"))}turnChange(){this.isPlayerTurn&&this.phase>1?(this.isPlayerTurn=!1,this.phase=0,r.classList.add("bell-hidden")):(this.isPlayerTurn=!0,r.classList.remove("bell-hidden"))}init(){const e=document.getElementById("player-deck");r.addEventListener("click",(()=>{this.isPlayerTurn&&this.phase>1&&!this.field.isArranging&&(this.battle(),this.turnChange())})),this.isPlayerTurn?r.classList.remove("bell-hidden"):r.classList.add("bell-hidden"),this.field.init(),this.player.initHand(),e.addEventListener("click",(()=>{this.player.hand.size<10&&this.player.deck.size>0&&this.drawCard()}))}newArrange(e){return n(this,void 0,void 0,(function*(){yield(0,s.Wait)(.25),this.field.selectCard(e),this.phase++}))}addToHand(e){this.player.hand.set(e.uid,e)}drawCard(e){if(this.isPlayerTurn&&1===this.phase||e){let t=this.player.deck.get(this.player.deck.size-1);this.player.removeToDeck(this.player.deck.size-1),this.addToHand(t);const i=document.getElementById("player-hand"),a=document.createElement("img"),r=document.body,l=r.getBoundingClientRect().width/100*10;a.src="./assets/card/front.png",a.alt=t.name,a.classList.add("card","card-on-hand"),a.id=`card-${t.uid}`,a.style.left=window.innerWidth-l-(20+5*this.player.deck.size)+"px",a.addEventListener("mouseover",(()=>{a.style.zIndex="2",a.style.transform+="translateY(-20px)",d.innerText=`\n                    name: ${t.name}\n                    health: ${t.heal}\n                    attack: ${t.atk}\n                    defence: ${t.def}\n                `})),a.addEventListener("mouseout",(()=>{a.style.zIndex="1",a.style.transform+="translateY(20px)",d.innerText=""})),i.append(a),setTimeout((()=>{a.style.left=20+120*(this.player.hand.size-1)+"px"}),50),a.addEventListener("click",(()=>n(this,void 0,void 0,(function*(){if(this.isPlayerTurn&&2===this.phase){a.style.transform+=`translateY(${r.getBoundingClientRect().height/2}px)`,this.player.removeToHand(t.uid),this.newArrange(t),yield(0,s.Wait)(.2),i.removeChild(a);let e=0;this.player.hand.forEach((t=>{document.getElementById(`card-${t.uid}`).style.left=20+120*e+"px",e++}))}})))),e||this.phase++}}}},87:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0;const a=s(i(10)),r=i(768),d=document.getElementById("canvas").getContext("2d"),l=document.getElementById("card-info-on-field"),o=document.body,h=window.devicePixelRatio,c="../public/assets/card-zoneX4.png",p="../public/assets/card/frontX4.png";let f,u,y=!1;const g=new r.Card({uid:1,name:"asd",attack:1,defence:1,health:10});t.Field=class{constructor(e){this.isArranging=!1,this.fieldAxis={opponent:[],player:[]},this.fieldArrange={opponent:[g,void 0,g],player:[]},this.numOfCardZone=e,this.loop=this.loop.bind(this)}draw(){const e=Math.floor(o.getBoundingClientRect().height*h/100*60/2-u+4),t=Math.floor(o.getBoundingClientRect().width*h/2-f*this.numOfCardZone/2+4*(this.numOfCardZone-1)/2);for(let i=0;i<2;i++)for(let n=0;n<this.numOfCardZone;n++){const s=t+(f-4)*n,r=e+(u-4)*i;0===i?this.fieldAxis.opponent.push({x:s,y:r}):this.fieldAxis.player.push({x:s,y:r}),d.drawImage(a.default.get(c),s,r)}}renderCard(){this.fieldArrange.opponent.forEach(((e,t)=>{e&&d.drawImage(a.default.get(p),this.fieldAxis.opponent[t].x,this.fieldAxis.opponent[t].y)})),this.fieldArrange.player.forEach(((e,t)=>{e&&d.drawImage(a.default.get(p),this.fieldAxis.player[t].x,this.fieldAxis.player[t].y)}))}selectCard(e){return n(this,void 0,void 0,(function*(){this.selectedCard=e,this.isArranging=!0,y=!0}))}newArrange(e,t){this.fieldArrange.player[t]=e}kill(e,t){0===e?this.fieldArrange.opponent[t]=void 0:1===e&&(this.fieldArrange.player[t]=void 0)}loop(){d.clearRect(0,0,o.getBoundingClientRect().width*h,o.getBoundingClientRect().height*h),this.draw(),this.renderCard(),requestAnimationFrame(this.loop)}init(){window.addEventListener("mouseup",(e=>{if(y){const t=e.clientX,i=e.clientY;if(t&&i)for(let e=0;e<this.numOfCardZone;e++)t>=this.fieldAxis.player[e].x/h&&t<(this.fieldAxis.player[e].x+f)/h&&i>=this.fieldAxis.player[e].y/h&&i<(this.fieldAxis.player[e].y+u)/h&&(this.newArrange(this.selectedCard,e),y=!1,this.isArranging=!1)}})),window.addEventListener("mousemove",(e=>{const t=e.clientX,i=e.clientY;l.innerText="";for(let e=0;e<this.numOfCardZone;e++){if(t>=this.fieldAxis.opponent[e].x/h&&t<(this.fieldAxis.opponent[e].x+f)/h&&i>=this.fieldAxis.opponent[e].y/h&&i<(this.fieldAxis.opponent[e].y+u)/h&&this.fieldArrange.opponent[e]){const t=this.fieldArrange.opponent[e];l.innerText=`\n                                name: ${t.name}\n                                health: ${t.heal}\n                                attack: ${t.atk}\n                                defence: ${t.def}\n                            `}if(t>=this.fieldAxis.player[e].x/h&&t<(this.fieldAxis.player[e].x+f)/h&&i>=this.fieldAxis.player[e].y/h&&i<(this.fieldAxis.player[e].y+u)/h&&this.fieldArrange.player[e]){const t=this.fieldArrange.player[e];l.innerText=`\n                                name: ${t.name}\n                                health: ${t.heal}\n                                attack: ${t.atk}\n                                defence: ${t.def}\n                            `}}})),f=a.default.get(c).width,u=a.default.get(c).height;for(let e=0;e<this.numOfCardZone;e++)this.fieldArrange.player.push(void 0),this.fieldArrange.opponent.push(void 0);requestAnimationFrame(this.loop)}}},768:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Card=void 0,t.Card=class{constructor(e){this.uid=e.uid,this.name=e.name,this.atk=e.attack,this.def=e.defence,this.heal=e.health}}},630:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Opponent=void 0,t.Opponent=class{constructor(){}}},363:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0,t.Player=class{constructor(e){this.hand=new Map,this.deck=new Map,this.name=e}initHand(){this.hand.clear()}addToDeck(e){this.deck.set(this.deck.size,e),this.updateDeck()}removeToDeck(e){this.deck.delete(e),this.updateDeck()}removeToHand(e){this.hand.delete(e)}updateDeck(){const e=document.getElementById("player-deck");e.replaceChildren(),this.deck.forEach(((t,i)=>{const n=document.createElement("img");n.src="./assets/card/back.png",n.alt=t.name,n.classList.add("card"),n.style.right=5*i+20+"px",e.append(n)}))}}}},t={};!function i(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,i),a.exports}(607)})();