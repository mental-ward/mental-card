(()=>{"use strict";var e={607:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(768),a=i(363),r=i(934),d=i(630),l=n(i(10)),o=i(789),c=i(597),h=document.getElementById("canvas"),p=(h.getContext("2d"),window.devicePixelRatio);h.style.width=`${window.innerWidth}px`,h.style.height=`${window.innerHeight}px`,h.width=window.innerWidth*p,h.height=window.innerHeight*p;const f=new a.Player("tester"),u=new d.Opponent("loti");for(let e=0;e<5;e++)f.addToDeck(new s.Card(Object.assign({cardID:f.deck.size},o.humen))),f.addToDeck(new s.Card(Object.assign({cardID:f.deck.size},c.bird)));const y=new r.Game(5,{player:f,opponent:u});l.default.loadAll(["../public/assets/part/type/1X4.png","../public/assets/part/type/2X4.png","../public/assets/part/type/3X4.png","../public/assets/part/sacrificeX4.png","../public/assets/card-zoneX4.png","../public/assets/card/frontX4.png","../public/assets/monster/humenX4.png","../public/assets/monster/birdX4.png"]).then((()=>{y.start()}))},101:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasCardObject=void 0;const s=n(i(10));t.CanvasCardObject=class{constructor(e,t){this.x=0,this.y=0,this.card=e,this.x=t.x,this.y=t.y}draw(){const e=document.getElementById("canvas").getContext("2d"),t=`../public/assets/monster/${this.card.name}X4.png`,i=`../public/assets/part/type/${this.card.type}X4.png`;e.drawImage(s.default.get(t),this.x,this.y),e.drawImage(s.default.get("../public/assets/card/frontX4.png"),this.x,this.y),e.drawImage(s.default.get(i),this.x+68,this.y+112);for(let t=0;t<this.card.sacrifice;t++)e.drawImage(s.default.get("../public/assets/part/sacrificeX4.png"),this.x+8+24*t,this.y+136)}}},10:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});class n{static loadAll(e){return i(this,void 0,void 0,(function*(){yield new Promise((t=>i(this,void 0,void 0,(function*(){const i=e.map(((e,t)=>new Promise((i=>{const s=new Image;s.src=e,s.addEventListener("load",(()=>{n.assets[e]=s,i(t)}))}))));n.promises=i,yield Promise.allSettled(i).then((e=>{t("done"),console.log(e)}))}))))}))}static get(e){return n.assets[e]}}n.assets={},t.default=n},826:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Wait=void 0,t.Wait=function(e){return new Promise((t=>{setTimeout((()=>{t("")}),1e3*e)}))}},934:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;const s=i(826),a=i(87),r=document.getElementById("bell"),d=document.getElementById("card-info-on-hand");t.Game=class{constructor(e,t){this.isPlayerTurn=!0,this.phase=1,this.player=t.player,this.opponent=t.opponent,this.numOfCardZone=e,this.field=new a.Field(this.numOfCardZone)}start(){return n(this,void 0,void 0,(function*(){this.init();for(const[e,t]of this.opponent.deck)this.opponent.addToHand(t);for(let e=0;e<3;e++)yield(0,s.Wait)(.3),this.drawCard(!0)}))}battle(){for(let e=0;e<this.numOfCardZone;e++)this.isPlayerTurn?this.field.fieldArrange.player[e]&&(this.field.fieldArrange.opponent[e]?(this.field.fieldArrange.opponent[e].heal-=this.field.fieldArrange.player[e].atk,this.field.fieldArrange.opponent[e].heal<=0&&this.field.kill(0,e)):console.log("직접공격함")):this.field.fieldArrange.opponent[e]&&(this.field.fieldArrange.player[e]?(this.field.fieldArrange.player[e].heal-=this.field.fieldArrange.opponent[e].atk,this.field.fieldArrange.player[e].heal<=0&&this.field.kill(1,e)):console.log("직접공격딤함"))}turnChange(){this.isPlayerTurn&&this.phase>1?(this.isPlayerTurn=!1,this.phase=0,r.classList.add("bell-hidden"),this.intellect()):(this.phase++,this.isPlayerTurn=!0,r.classList.remove("bell-hidden"))}newArrange(e){return n(this,void 0,void 0,(function*(){yield(0,s.Wait)(.25),this.field.selectCard(e,this.isPlayerTurn),this.phase++}))}addToHand(e){this.player.hand.set(e.cardID,e)}drawCard(e){if(this.isPlayerTurn&&1===this.phase||e){let t=this.player.deck.get(this.player.deck.size-1);this.player.removeToDeck(this.player.deck.size-1),this.addToHand(t);const i=document.getElementById("player-hand"),a=document.createElement("div"),r=document.createElement("img"),l=document.createElement("img"),o=document.createElement("img"),c=document.body,h=c.getBoundingClientRect().width/100*10;r.src="./assets/card/front.png",l.src=`../public/assets/monster/${t.name}.png`,o.src=`../public/assets/part/type/${t.type}.png`,a.classList.add("card","card-on-hand"),r.classList.add("card-part"),l.classList.add("card-part"),o.classList.add("card-part-type"),a.append(l),a.append(r),a.append(o),a.id=`card-${t.cardID}`,a.style.left=window.innerWidth-h-(20+5*this.player.deck.size)+"px",a.addEventListener("mouseover",(()=>{a.style.zIndex="2",a.style.transform+="translateY(-20px)",d.innerText=`\n                cardID: ${t.cardID}\n                name: ${t.name}\n                type: ${t.type}\n                sacrifice: ${t.sacrifice}\n                health: ${t.heal}\n                attack: ${t.atk}\n                defence: ${t.def}\n                `})),a.addEventListener("mouseout",(()=>{a.style.zIndex="1",a.style.transform+="translateY(20px)",d.innerText=""})),i.append(a);const p=r.getBoundingClientRect().width/39;o.style.width=5*p+"px",o.style.transform=`translate(${17*p}px, ${28*p}px)`;for(let e=0;e<t.sacrifice;e++){const t=document.createElement("img");t.src="../public/assets/part/sacrificeX4.png",t.classList.add("card-part-sacrifice"),a.append(t),t.style.width=5*p+"px",t.style.transform=`translate(${2*p+6*p*e}px, ${34*p}px)`}a.style.height=65*p+"px",setTimeout((()=>{a.style.left=20+120*(this.player.hand.size-1)+"px"}),50),a.addEventListener("click",(()=>n(this,void 0,void 0,(function*(){if(this.isPlayerTurn&&this.phase<=2){a.style.transform+=`translateY(${c.getBoundingClientRect().height/2}px)`,this.player.removeToHand(t.cardID),this.newArrange(t),yield(0,s.Wait)(.2),i.removeChild(a);let e=0;this.player.hand.forEach((t=>{document.getElementById(`card-${t.cardID}`).style.left=20+120*e+"px",e++}))}})))),e||this.phase++}}intellect(){return n(this,void 0,void 0,(function*(){let e,t,i=0;const n=this.opponent.hand,a=this.field.fieldArrange.opponent,r=this.field.fieldArrange.player;console.log(n);for(const[s,d]of n)for(let n=0;n<this.numOfCardZone;n++)if(r[n]&&!a[n]){const s=d.atk;i<s&&(i=s,e=d,t=n)}e&&(yield(0,s.Wait)(1),this.field.placeCard(e,t,this.isPlayerTurn),this.opponent.removeToHand(e.cardID)),yield(0,s.Wait)(1),this.battle(),this.turnChange()}))}init(){const e=document.getElementById("player-deck");r.addEventListener("click",(()=>{this.isPlayerTurn&&this.phase>1&&!this.field.isArranging&&(this.battle(),this.turnChange())})),this.isPlayerTurn?r.classList.remove("bell-hidden"):r.classList.add("bell-hidden"),this.field.init(),this.player.initHand(),e.addEventListener("click",(()=>{this.player.hand.size<10&&this.player.deck.size>0&&this.drawCard()}))}}},87:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0;const a=i(101),r=s(i(10)),d=i(768),l=document.getElementById("canvas").getContext("2d"),o=document.getElementById("card-info-on-field"),c=document.body,h=window.devicePixelRatio,p="../public/assets/card-zoneX4.png";let f,u,y=!1;const m=new d.Card({cardID:1,name:"humen",type:1,sacrifice:5,attack:2,defence:3,health:4});t.Field=class{constructor(e){this.isArranging=!1,this.fieldAxis={opponent:[],player:[]},this.fieldArrange={opponent:[m],player:[]},this.isPlayerTurn=!0,this.numOfCardZone=e,this.loop=this.loop.bind(this)}draw(){const e=Math.floor(c.getBoundingClientRect().height*h/100*60/2-u+4),t=Math.floor(c.getBoundingClientRect().width*h/2-f*this.numOfCardZone/2+4*(this.numOfCardZone-1)/2);for(let i=0;i<2;i++)for(let n=0;n<this.numOfCardZone;n++){const s=t+(f-4)*n,a=e+(u-4)*i;0===i?this.fieldAxis.opponent.push({x:s,y:a}):this.fieldAxis.player.push({x:s,y:a}),l.drawImage(r.default.get(p),s,a)}}renderCard(){this.fieldArrange.opponent.forEach(((e,t)=>{e&&new a.CanvasCardObject(e,{x:this.fieldAxis.opponent[t].x,y:this.fieldAxis.opponent[t].y}).draw()})),this.fieldArrange.player.forEach(((e,t)=>{e&&new a.CanvasCardObject(e,{x:this.fieldAxis.player[t].x,y:this.fieldAxis.player[t].y}).draw()}))}selectCard(e,t){return n(this,void 0,void 0,(function*(){this.selectedCard=e,this.isArranging=!0,this.isPlayerTurn=t,y=!0}))}placeCard(e,t,i){i?this.fieldArrange.player[t]=e:this.fieldArrange.opponent[t]=e}kill(e,t){0===e?this.fieldArrange.opponent[t]=void 0:1===e&&(this.fieldArrange.player[t]=void 0)}loop(){l.clearRect(0,0,c.getBoundingClientRect().width*h,c.getBoundingClientRect().height*h),this.draw(),this.renderCard(),requestAnimationFrame(this.loop)}init(){window.addEventListener("click",(e=>{if(y){const t=e.clientX,i=e.clientY;if(t&&i)for(let e=0;e<this.numOfCardZone;e++)t>=this.fieldAxis.player[e].x/h&&t<(this.fieldAxis.player[e].x+f)/h&&i>=this.fieldAxis.player[e].y/h&&i<(this.fieldAxis.player[e].y+u)/h&&(this.placeCard(this.selectedCard,e,this.isPlayerTurn),y=!1,this.isArranging=!1)}})),window.addEventListener("mousemove",(e=>{const t=e.clientX,i=e.clientY;o.innerText="";for(let e=0;e<this.numOfCardZone;e++){if(t>=this.fieldAxis.opponent[e].x/h&&t<(this.fieldAxis.opponent[e].x+f)/h&&i>=this.fieldAxis.opponent[e].y/h&&i<(this.fieldAxis.opponent[e].y+u)/h&&this.fieldArrange.opponent[e]){const t=this.fieldArrange.opponent[e];o.innerText=`\n                                cardID: ${t.cardID}\n                                name: ${t.name}\n                                type: ${t.type}\n                                sacrifice: ${t.sacrifice}\n                                health: ${t.heal}\n                                attack: ${t.atk}\n                                defence: ${t.def}\n                            `}if(t>=this.fieldAxis.player[e].x/h&&t<(this.fieldAxis.player[e].x+f)/h&&i>=this.fieldAxis.player[e].y/h&&i<(this.fieldAxis.player[e].y+u)/h&&this.fieldArrange.player[e]){const t=this.fieldArrange.player[e];o.innerText=`\n                                cardID: ${t.cardID}\n                                name: ${t.name}\n                                type: ${t.type}\n                                sacrifice: ${t.sacrifice}\n                                health: ${t.heal}\n                                attack: ${t.atk}\n                                defence: ${t.def}\n                            `}}})),f=r.default.get(p).width,u=r.default.get(p).height;for(let e=0;e<this.numOfCardZone;e++)this.fieldArrange.player.push(void 0),this.fieldArrange.opponent.push(void 0);requestAnimationFrame(this.loop)}}},768:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Card=void 0,t.Card=class{constructor(e){this.cardID=e.cardID,this.name=e.name,this.type=e.type,this.sacrifice=e.sacrifice,this.atk=e.attack,this.def=e.defence,this.heal=e.health}}},630:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Opponent=void 0,t.Opponent=class{constructor(e){this.hand=new Map,this.deck=new Map,this.name=e}addToHand(e){this.hand.set(e.cardID,e)}addToDeck(e){this.deck.set(this.deck.size,e)}removeToHand(e){this.hand.delete(e)}removeToDeck(e){this.deck.delete(e)}}},363:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0,t.Player=class{constructor(e){this.hand=new Map,this.deck=new Map,this.name=e}initHand(){this.hand.clear()}addToDeck(e){this.deck.set(e.cardID,e),this.updateDeck()}removeToDeck(e){this.deck.delete(e),this.updateDeck()}removeToHand(e){this.hand.delete(e)}updateDeck(){const e=document.getElementById("player-deck");e.replaceChildren(),this.deck.forEach(((t,i)=>{const n=document.createElement("img");n.src="./assets/card/back.png",n.alt=t.name,n.classList.add("card"),n.style.right=5*i+20+"px",e.append(n)}))}}},597:e=>{e.exports=JSON.parse('{"bird":{"name":"bird","type":1,"sacrifice":0,"attack":1,"defence":1,"health":1}}')},789:e=>{e.exports=JSON.parse('{"humen":{"name":"humen","type":1,"sacrifice":1,"attack":2,"defence":2,"health":3}}')}},t={};!function i(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,i),a.exports}(607)})();